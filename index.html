<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KAVISHFORTECH | 200 LEVELS</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Syncopate:wght@700&family=JetBrains+Mono:wght@800&display=swap');
        
        :root {
            --neon-blue: #00f2ff;
            --neon-pink: #ff00ea;
            --track-gray: #1a1a1d;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; touch-action: none; user-select: none; }

        body {
            background: #000;
            font-family: 'JetBrains Mono', monospace;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
            color: white;
        }

        /* --- LEVEL PROGRESS BAR --- */
        .progress-container {
            width: 100%;
            height: 6px;
            background: #222;
            position: relative;
        }
        #progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--neon-blue), var(--neon-pink));
            transition: width 0.3s;
        }

        .top-nav {
            width: 100%;
            background: #000;
            padding: 10px;
            display: flex;
            justify-content: space-around;
            border-bottom: 1px solid #333;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 55vh;
            background: linear-gradient(to bottom, #020024, #090979, #00d4ff);
            overflow: hidden;
        }

        canvas { width: 100%; height: 100%; }

        .hud {
            position: absolute;
            top: 15px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
            z-index: 10;
        }

        .hud-item {
            background: rgba(0,0,0,0.8);
            padding: 8px 12px;
            border-radius: 4px;
            border-bottom: 2px solid var(--neon-blue);
        }

        .label { font-size: 0.5rem; color: #aaa; display: block; }
        .val { font-size: 1rem; color: #fff; }

        /* --- MOBILE CONTROLS --- */
        .input-grid {
            width: 100%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            flex-grow: 1;
        }

        .touch-zone {
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #111;
            background: #050505;
        }

        .zone-label { font-family: 'Syncopate'; font-size: 1.2rem; color: #222; }
        .touch-zone:active { background: #111; }

        .overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
    </style>
</head>
<body>

    <div class="progress-container"><div id="progress-bar"></div></div>

    <div class="top-nav">
        <button class="btn-sys" style="background:none; border:1px solid #444; color:white; padding:5px 15px; font-family:'Syncopate'; font-size:0.6rem;" onclick="core.start()">START_LEVEL_1</button>
        <button class="btn-sys" style="background:none; border:1px solid #444; color:white; padding:5px 15px; font-family:'Syncopate'; font-size:0.6rem;" onclick="core.abort()">ABORT</button>
    </div>

    <div id="game-container">
        <div class="hud">
            <div class="hud-item"><span class="label">LVL</span><span class="val" id="lvl-val">1/200</span></div>
            <div class="hud-item"><span class="label">GOAL</span><span class="val" id="dist-val">0m</span></div>
        </div>

        <canvas id="stage"></canvas>

        <div id="start-screen" class="overlay">
            <h1 style="font-family:'Syncopate'; color:var(--neon-blue);">200 LEVELS</h1>
            <p style="margin-top:10px; color:#444;">KAVISHFORTECH // SYSTEM ARCHITECT</p>
        </div>

        <div id="death-screen" class="overlay" style="display:none;">
            <h1 style="font-family:'Syncopate'; color:var(--neon-pink);">LEVEL FAILED</h1>
            <p id="death-info" style="font-size:0.7rem; color:#888; margin:10px;"></p>
            <button onclick="core.start()" style="padding:10px 30px; background:var(--neon-blue); border:none; color:black; font-family:'Syncopate'; cursor:pointer;">RE-INIT</button>
        </div>
    </div>

    <div class="input-grid">
        <div class="touch-zone" id="jump-zone"><span class="zone-label">UP_JUMP</span></div>
        <div class="touch-zone" id="roll-zone"><span class="zone-label">DN_ROLL</span></div>
    </div>

    <script>
        const canvas = document.getElementById('stage');
        const ctx = canvas.getContext('2d');

        const core = {
            running: false,
            level: 1,
            distanceInLevel: 0,
            levelLength: 2000, // Distance required to pass level
            
            start() {
                canvas.width = window.innerWidth;
                canvas.height = canvas.offsetHeight;
                this.running = true;
                this.distanceInLevel = 0;
                player.init();
                world.init();
                document.getElementById('start-screen').style.display = 'none';
                document.getElementById('death-screen').style.display = 'none';
                this.loop();
            },

            abort() { this.running = false; document.getElementById('start-screen').style.display = 'flex'; },

            nextLevel() {
                this.level++;
                this.distanceInLevel = 0;
                this.levelLength += 500; // Each level gets longer
                world.speed += 0.5;
                if(this.level > 200) alert("CONGRATULATIONS: ARCHITECT MASTER");
            },

            update() {
                this.distanceInLevel += world.speed;
                const progress = (this.distanceInLevel / this.levelLength) * 100;
                document.getElementById('progress-bar').style.width = progress + "%";
                document.getElementById('lvl-val').innerText = this.level + "/200";
                document.getElementById('dist-val').innerText = Math.floor(this.levelLength - this.distanceInLevel) + "m";

                if(this.distanceInLevel >= this.levelLength) this.nextLevel();

                player.update();
                world.update();
            },

            draw() {
                ctx.clearRect(0,0, canvas.width, canvas.height);
                world.draw();
                player.draw();
            },

            loop() {
                if(!this.running) return;
                this.update(); this.draw();
                requestAnimationFrame(() => this.loop());
            }
        };

        const player = {
            x: 100, y: 0, w: 35, h: 55, vY: 0, 
            isJumping: false, isRolling: false, rollCounter: 0,
            
            init() { this.y = canvas.height - 100; this.vY = 0; },

            update() {
                this.vY += 0.9; // Gravity
                this.y += this.vY;
                const ground = canvas.height - (this.isRolling ? 65 : 95);
                if(this.y > ground) { this.y = ground; this.vY = 0; this.isJumping = false; }
                if(this.isRolling) { this.rollCounter--; if(this.rollCounter <= 0) this.isRolling = false; }
            },

            jump() { if(!this.isJumping) { this.vY = -17; this.isJumping = true; } },
            roll() { if(!this.isJumping) { this.isRolling = true; this.rollCounter = 45; } },

            draw() {
                const drawH = this.isRolling ? 30 : 55;
                ctx.fillStyle = "#3498db"; ctx.fillRect(this.x, this.y, 35, drawH); // Body
                ctx.fillStyle = "red"; ctx.fillRect(this.x + 5, this.y - 12, 25, 12); // Head
            }
        };

        const world = {
            speed: 6,
            items: [],
            
            init() { this.items = []; },

            update() {
                // Difficulty Scaling based on level
                const spawnRate = 0.02 + (core.level * 0.0005);
                if(Math.random() < spawnRate) {
                    const type = Math.random() > 0.5 ? 'low' : 'high';
                    this.items.push({
                        x: canvas.width + 50,
                        y: type === 'low' ? canvas.height - 95 : canvas.height - 160,
                        w: 30, h: type === 'low' ? 60 : 30,
                        type: type
                    });
                }

                for(let i=this.items.length-1; i>=0; i--) {
                    let it = this.items[i];
                    it.x -= this.speed;

                    // Improved Mario Collision
                    if(it.x < player.x + 35 && it.x + it.w > player.x &&
                       it.y < player.y + (player.isRolling ? 30 : 55) && it.y + it.h > player.y) {
                        core.running = false;
                        document.getElementById('death-screen').style.display = 'flex';
                        document.getElementById('death-info').innerText = "FAILED AT LEVEL " + core.level;
                    }
                    if(it.x < -50) this.items.splice(i, 1);
                }
            },

            draw() {
                ctx.fillStyle = "#222"; ctx.fillRect(0, canvas.height-40, canvas.width, 40); // Ground
                this.items.forEach(it => {
                    ctx.fillStyle = it.type === 'low' ? "#e74c3c" : "#f1c40f";
                    ctx.fillRect(it.x, it.y, it.w, it.h);
                });
            }
        };

        document.getElementById('jump-zone').addEventListener('pointerdown', () => player.jump());
        document.getElementById('roll-zone').addEventListener('pointerdown', () => player.roll());
    </script>
</body>
</html>
